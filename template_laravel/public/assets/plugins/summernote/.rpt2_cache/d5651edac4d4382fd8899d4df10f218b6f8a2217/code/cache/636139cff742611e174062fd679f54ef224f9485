{"code":"import $ from 'jquery';\r\nimport env from '../core/env';\r\nimport key from '../core/key';\r\nvar ImageDialog = /** @class */ (function () {\r\n    function ImageDialog(context) {\r\n        this.context = context;\r\n        this.ui = $.summernote.ui;\r\n        this.$body = $(document.body);\r\n        this.$editor = context.layoutInfo.editor;\r\n        this.options = context.options;\r\n        this.lang = this.options.langInfo;\r\n    }\r\n    ImageDialog.prototype.initialize = function () {\r\n        var $container = this.options.dialogsInBody ? this.$body : this.$editor;\r\n        var imageLimitation = '';\r\n        if (this.options.maximumImageFileSize) {\r\n            var unit = Math.floor(Math.log(this.options.maximumImageFileSize) / Math.log(1024));\r\n            var readableSize = (this.options.maximumImageFileSize / Math.pow(1024, unit)).toFixed(2) * 1 +\r\n                ' ' + ' KMGTP'[unit] + 'B';\r\n            imageLimitation = \"<small>\" + (this.lang.image.maximumFileSize + ' : ' + readableSize) + \"</small>\";\r\n        }\r\n        var body = [\r\n            '<div class=\"form-group note-form-group note-group-select-from-files\">',\r\n            '<label class=\"note-form-label\">' + this.lang.image.selectFromFiles + '</label>',\r\n            '<input class=\"note-image-input note-form-control note-input\" ',\r\n            ' type=\"file\" name=\"files\" accept=\"image/*\" multiple=\"multiple\" />',\r\n            imageLimitation,\r\n            '</div>',\r\n            '<div class=\"form-group note-group-image-url\" style=\"overflow:auto;\">',\r\n            '<label class=\"note-form-label\">' + this.lang.image.url + '</label>',\r\n            '<input class=\"note-image-url form-control note-form-control note-input ',\r\n            ' col-md-12\" type=\"text\" />',\r\n            '</div>'\r\n        ].join('');\r\n        var buttonClass = 'btn btn-primary note-btn note-btn-primary note-image-btn';\r\n        var footer = \"<button type=\\\"submit\\\" href=\\\"#\\\" class=\\\"\" + buttonClass + \"\\\" disabled>\" + this.lang.image.insert + \"</button>\";\r\n        this.$dialog = this.ui.dialog({\r\n            title: this.lang.image.insert,\r\n            fade: this.options.dialogsFade,\r\n            body: body,\r\n            footer: footer\r\n        }).render().appendTo($container);\r\n    };\r\n    ImageDialog.prototype.destroy = function () {\r\n        this.ui.hideDialog(this.$dialog);\r\n        this.$dialog.remove();\r\n    };\r\n    ImageDialog.prototype.bindEnterKey = function ($input, $btn) {\r\n        $input.on('keypress', function (event) {\r\n            if (event.keyCode === key.code.ENTER) {\r\n                event.preventDefault();\r\n                $btn.trigger('click');\r\n            }\r\n        });\r\n    };\r\n    ImageDialog.prototype.show = function () {\r\n        var _this = this;\r\n        this.context.invoke('editor.saveRange');\r\n        this.showImageDialog().then(function (data) {\r\n            // [workaround] hide dialog before restore range for IE range focus\r\n            _this.ui.hideDialog(_this.$dialog);\r\n            _this.context.invoke('editor.restoreRange');\r\n            if (typeof data === 'string') {\r\n                _this.context.invoke('editor.insertImage', data);\r\n            }\r\n            else {\r\n                _this.context.invoke('editor.insertImagesOrCallback', data);\r\n            }\r\n        }).fail(function () {\r\n            _this.context.invoke('editor.restoreRange');\r\n        });\r\n    };\r\n    /**\r\n     * show image dialog\r\n     *\r\n     * @param {jQuery} $dialog\r\n     * @return {Promise}\r\n     */\r\n    ImageDialog.prototype.showImageDialog = function () {\r\n        var _this = this;\r\n        return $.Deferred(function (deferred) {\r\n            var $imageInput = _this.$dialog.find('.note-image-input');\r\n            var $imageUrl = _this.$dialog.find('.note-image-url');\r\n            var $imageBtn = _this.$dialog.find('.note-image-btn');\r\n            _this.ui.onDialogShown(_this.$dialog, function () {\r\n                _this.context.triggerEvent('dialog.shown');\r\n                // Cloning imageInput to clear element.\r\n                $imageInput.replaceWith($imageInput.clone().on('change', function (event) {\r\n                    deferred.resolve(event.target.files || event.target.value);\r\n                }).val(''));\r\n                $imageBtn.click(function (event) {\r\n                    event.preventDefault();\r\n                    deferred.resolve($imageUrl.val());\r\n                });\r\n                $imageUrl.on('keyup paste', function () {\r\n                    var url = $imageUrl.val();\r\n                    _this.ui.toggleBtn($imageBtn, url);\r\n                }).val('');\r\n                if (!env.isSupportTouch) {\r\n                    $imageUrl.trigger('focus');\r\n                }\r\n                _this.bindEnterKey($imageUrl, $imageBtn);\r\n            });\r\n            _this.ui.onDialogHidden(_this.$dialog, function () {\r\n                $imageInput.off('change');\r\n                $imageUrl.off('keyup paste keypress');\r\n                $imageBtn.off('click');\r\n                if (deferred.state() === 'pending') {\r\n                    deferred.reject();\r\n                }\r\n            });\r\n            _this.ui.showDialog(_this.$dialog);\r\n        });\r\n    };\r\n    return ImageDialog;\r\n}());\r\nexport default ImageDialog;\r\n//# sourceMappingURL=ImageDialog.js.map","map":{"version":3,"file":"ImageDialog.js","sourceRoot":"","sources":["../../src/js/base/module/ImageDialog.js"],"names":[],"mappings":"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"}}
