{"code":"import $ from 'jquery';\r\nimport env from '../core/env';\r\nimport key from '../core/key';\r\nvar LinkDialog = /** @class */ (function () {\r\n    function LinkDialog(context) {\r\n        this.context = context;\r\n        this.ui = $.summernote.ui;\r\n        this.$body = $(document.body);\r\n        this.$editor = context.layoutInfo.editor;\r\n        this.options = context.options;\r\n        this.lang = this.options.langInfo;\r\n        context.memo('help.linkDialog.show', this.options.langInfo.help['linkDialog.show']);\r\n    }\r\n    LinkDialog.prototype.initialize = function () {\r\n        var $container = this.options.dialogsInBody ? this.$body : this.$editor;\r\n        var body = [\r\n            '<div class=\"form-group note-form-group\">',\r\n            \"<label class=\\\"note-form-label\\\">\" + this.lang.link.textToDisplay + \"</label>\",\r\n            '<input class=\"note-link-text form-control note-form-control  note-input\" type=\"text\" />',\r\n            '</div>',\r\n            '<div class=\"form-group note-form-group\">',\r\n            \"<label class=\\\"note-form-label\\\">\" + this.lang.link.url + \"</label>\",\r\n            '<input class=\"note-link-url form-control note-form-control note-input\" type=\"text\" value=\"http://\" />',\r\n            '</div>',\r\n            !this.options.disableLinkTarget\r\n                ? $('<div/>').append(this.ui.checkbox({\r\n                    id: 'sn-checkbox-open-in-new-window',\r\n                    text: this.lang.link.openInNewWindow,\r\n                    checked: true\r\n                }).render()).html()\r\n                : ''\r\n        ].join('');\r\n        var buttonClass = 'btn btn-primary note-btn note-btn-primary note-link-btn';\r\n        var footer = \"<button type=\\\"submit\\\" href=\\\"#\\\" class=\\\"\" + buttonClass + \"\\\" disabled>\" + this.lang.link.insert + \"</button>\";\r\n        this.$dialog = this.ui.dialog({\r\n            className: 'link-dialog',\r\n            title: this.lang.link.insert,\r\n            fade: this.options.dialogsFade,\r\n            body: body,\r\n            footer: footer\r\n        }).render().appendTo($container);\r\n    };\r\n    LinkDialog.prototype.destroy = function () {\r\n        this.ui.hideDialog(this.$dialog);\r\n        this.$dialog.remove();\r\n    };\r\n    LinkDialog.prototype.bindEnterKey = function ($input, $btn) {\r\n        $input.on('keypress', function (event) {\r\n            if (event.keyCode === key.code.ENTER) {\r\n                event.preventDefault();\r\n                $btn.trigger('click');\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * toggle update button\r\n     */\r\n    LinkDialog.prototype.toggleLinkBtn = function ($linkBtn, $linkText, $linkUrl) {\r\n        this.ui.toggleBtn($linkBtn, $linkText.val() && $linkUrl.val());\r\n    };\r\n    /**\r\n     * Show link dialog and set event handlers on dialog controls.\r\n     *\r\n     * @param {Object} linkInfo\r\n     * @return {Promise}\r\n     */\r\n    LinkDialog.prototype.showLinkDialog = function (linkInfo) {\r\n        var _this = this;\r\n        return $.Deferred(function (deferred) {\r\n            var $linkText = _this.$dialog.find('.note-link-text');\r\n            var $linkUrl = _this.$dialog.find('.note-link-url');\r\n            var $linkBtn = _this.$dialog.find('.note-link-btn');\r\n            var $openInNewWindow = _this.$dialog.find('input[type=checkbox]');\r\n            _this.ui.onDialogShown(_this.$dialog, function () {\r\n                _this.context.triggerEvent('dialog.shown');\r\n                // if no url was given, copy text to url\r\n                if (!linkInfo.url) {\r\n                    linkInfo.url = linkInfo.text;\r\n                }\r\n                $linkText.val(linkInfo.text);\r\n                var handleLinkTextUpdate = function () {\r\n                    _this.toggleLinkBtn($linkBtn, $linkText, $linkUrl);\r\n                    // if linktext was modified by keyup,\r\n                    // stop cloning text from linkUrl\r\n                    linkInfo.text = $linkText.val();\r\n                };\r\n                $linkText.on('input', handleLinkTextUpdate).on('paste', function () {\r\n                    setTimeout(handleLinkTextUpdate, 0);\r\n                });\r\n                var handleLinkUrlUpdate = function () {\r\n                    _this.toggleLinkBtn($linkBtn, $linkText, $linkUrl);\r\n                    // display same link on `Text to display` input\r\n                    // when create a new link\r\n                    if (!linkInfo.text) {\r\n                        $linkText.val($linkUrl.val());\r\n                    }\r\n                };\r\n                $linkUrl.on('input', handleLinkUrlUpdate).on('paste', function () {\r\n                    setTimeout(handleLinkUrlUpdate, 0);\r\n                }).val(linkInfo.url);\r\n                if (!env.isSupportTouch) {\r\n                    $linkUrl.trigger('focus');\r\n                }\r\n                _this.toggleLinkBtn($linkBtn, $linkText, $linkUrl);\r\n                _this.bindEnterKey($linkUrl, $linkBtn);\r\n                _this.bindEnterKey($linkText, $linkBtn);\r\n                var isChecked = linkInfo.isNewWindow !== undefined\r\n                    ? linkInfo.isNewWindow : _this.context.options.linkTargetBlank;\r\n                $openInNewWindow.prop('checked', isChecked);\r\n                $linkBtn.one('click', function (event) {\r\n                    event.preventDefault();\r\n                    deferred.resolve({\r\n                        range: linkInfo.range,\r\n                        url: $linkUrl.val(),\r\n                        text: $linkText.val(),\r\n                        isNewWindow: $openInNewWindow.is(':checked')\r\n                    });\r\n                    _this.ui.hideDialog(_this.$dialog);\r\n                });\r\n            });\r\n            _this.ui.onDialogHidden(_this.$dialog, function () {\r\n                // detach events\r\n                $linkText.off('input paste keypress');\r\n                $linkUrl.off('input paste keypress');\r\n                $linkBtn.off('click');\r\n                if (deferred.state() === 'pending') {\r\n                    deferred.reject();\r\n                }\r\n            });\r\n            _this.ui.showDialog(_this.$dialog);\r\n        }).promise();\r\n    };\r\n    /**\r\n     * @param {Object} layoutInfo\r\n     */\r\n    LinkDialog.prototype.show = function () {\r\n        var _this = this;\r\n        var linkInfo = this.context.invoke('editor.getLinkInfo');\r\n        this.context.invoke('editor.saveRange');\r\n        this.showLinkDialog(linkInfo).then(function (linkInfo) {\r\n            _this.context.invoke('editor.restoreRange');\r\n            _this.context.invoke('editor.createLink', linkInfo);\r\n        }).fail(function () {\r\n            _this.context.invoke('editor.restoreRange');\r\n        });\r\n    };\r\n    return LinkDialog;\r\n}());\r\nexport default LinkDialog;\r\n//# sourceMappingURL=LinkDialog.js.map","map":{"version":3,"file":"LinkDialog.js","sourceRoot":"","sources":["../../src/js/base/module/LinkDialog.js"],"names":[],"mappings":"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"}}
