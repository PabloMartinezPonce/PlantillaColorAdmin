{"code":"import $ from 'jquery';\r\nvar Dropzone = /** @class */ (function () {\r\n    function Dropzone(context) {\r\n        this.context = context;\r\n        this.$eventListener = $(document);\r\n        this.$editor = context.layoutInfo.editor;\r\n        this.$editable = context.layoutInfo.editable;\r\n        this.options = context.options;\r\n        this.lang = this.options.langInfo;\r\n        this.documentEventHandlers = {};\r\n        this.$dropzone = $([\r\n            '<div class=\"note-dropzone\">',\r\n            '  <div class=\"note-dropzone-message\"/>',\r\n            '</div>'\r\n        ].join('')).prependTo(this.$editor);\r\n    }\r\n    /**\r\n     * attach Drag and Drop Events\r\n     */\r\n    Dropzone.prototype.initialize = function () {\r\n        if (this.options.disableDragAndDrop) {\r\n            // prevent default drop event\r\n            this.documentEventHandlers.onDrop = function (e) {\r\n                e.preventDefault();\r\n            };\r\n            // do not consider outside of dropzone\r\n            this.$eventListener = this.$dropzone;\r\n            this.$eventListener.on('drop', this.documentEventHandlers.onDrop);\r\n        }\r\n        else {\r\n            this.attachDragAndDropEvent();\r\n        }\r\n    };\r\n    /**\r\n     * attach Drag and Drop Events\r\n     */\r\n    Dropzone.prototype.attachDragAndDropEvent = function () {\r\n        var _this = this;\r\n        var collection = $();\r\n        var $dropzoneMessage = this.$dropzone.find('.note-dropzone-message');\r\n        this.documentEventHandlers.onDragenter = function (e) {\r\n            var isCodeview = _this.context.invoke('codeview.isActivated');\r\n            var hasEditorSize = _this.$editor.width() > 0 && _this.$editor.height() > 0;\r\n            if (!isCodeview && !collection.length && hasEditorSize) {\r\n                _this.$editor.addClass('dragover');\r\n                _this.$dropzone.width(_this.$editor.width());\r\n                _this.$dropzone.height(_this.$editor.height());\r\n                $dropzoneMessage.text(_this.lang.image.dragImageHere);\r\n            }\r\n            collection = collection.add(e.target);\r\n        };\r\n        this.documentEventHandlers.onDragleave = function (e) {\r\n            collection = collection.not(e.target);\r\n            if (!collection.length) {\r\n                _this.$editor.removeClass('dragover');\r\n            }\r\n        };\r\n        this.documentEventHandlers.onDrop = function () {\r\n            collection = $();\r\n            _this.$editor.removeClass('dragover');\r\n        };\r\n        // show dropzone on dragenter when dragging a object to document\r\n        // -but only if the editor is visible, i.e. has a positive width and height\r\n        this.$eventListener.on('dragenter', this.documentEventHandlers.onDragenter)\r\n            .on('dragleave', this.documentEventHandlers.onDragleave)\r\n            .on('drop', this.documentEventHandlers.onDrop);\r\n        // change dropzone's message on hover.\r\n        this.$dropzone.on('dragenter', function () {\r\n            _this.$dropzone.addClass('hover');\r\n            $dropzoneMessage.text(_this.lang.image.dropImage);\r\n        }).on('dragleave', function () {\r\n            _this.$dropzone.removeClass('hover');\r\n            $dropzoneMessage.text(_this.lang.image.dragImageHere);\r\n        });\r\n        // attach dropImage\r\n        this.$dropzone.on('drop', function (event) {\r\n            var dataTransfer = event.originalEvent.dataTransfer;\r\n            // stop the browser from opening the dropped content\r\n            event.preventDefault();\r\n            if (dataTransfer && dataTransfer.files && dataTransfer.files.length) {\r\n                _this.$editable.focus();\r\n                _this.context.invoke('editor.insertImagesOrCallback', dataTransfer.files);\r\n            }\r\n            else {\r\n                $.each(dataTransfer.types, function (idx, type) {\r\n                    var content = dataTransfer.getData(type);\r\n                    if (type.toLowerCase().indexOf('text') > -1) {\r\n                        _this.context.invoke('editor.pasteHTML', content);\r\n                    }\r\n                    else {\r\n                        $(content).each(function (idx, item) {\r\n                            _this.context.invoke('editor.insertNode', item);\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n        }).on('dragover', false); // prevent default dragover event\r\n    };\r\n    Dropzone.prototype.destroy = function () {\r\n        var _this = this;\r\n        Object.keys(this.documentEventHandlers).forEach(function (key) {\r\n            _this.$eventListener.off(key.substr(2).toLowerCase(), _this.documentEventHandlers[key]);\r\n        });\r\n        this.documentEventHandlers = {};\r\n    };\r\n    return Dropzone;\r\n}());\r\nexport default Dropzone;\r\n//# sourceMappingURL=Dropzone.js.map","map":{"version":3,"file":"Dropzone.js","sourceRoot":"","sources":["../../src/js/base/module/Dropzone.js"],"names":[],"mappings":"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"}}
